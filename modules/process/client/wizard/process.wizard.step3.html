<h2>Add Transformations</h2>
<div class="row">
    <div class="col-md-6">
        <p><strong>New Dataset: </strong>{{ ProcessStep3.selecteddataset.title }}</p>
        <div class="loader text-center" ng-show="ProcessStep3.showLoader">
            <i class="spinner"></i>
        </div>
        <div class="overflow: auto;" ng-show="!ProcessStep3.showLoader">
            <div style="overflow: auto;">
                <table class="table table-striped table-bordered">
                    <thead>
                    <th ng-repeat="column in ProcessStep3.currentdataset.columns"><a href="" ng-click="ProcessStep3.excludedcolumns[column] = !ProcessStep3.excludedcolumns[column]; ProcessStep3.finalDatasetColumnsChanged()"><span class="glyphicon glyphicon-remove pull-right" ng-class="{ 'exclude' : ProcessStep3.excludedcolumns[column] }"></span></a></th>
                    </thead>
                    <thead>
                        <th ng-repeat="column in ProcessStep3.currentdataset.columns" ng-bind="column" ng-class="{ 'exclude' : ProcessStep3.excludedcolumns[column] }"></th>
                    </thead>
                    <thead>
                        <th ng-repeat="column in ProcessStep3.currentdataset.renamedcolumns" ng-class="{ 'exclude' : ProcessStep3.excludedcolumns[column] }"><input type="text" class="form-control" ng-model="column" ng-change="ProcessStep3.finalDatasetColumnsChanged()" ng-disabled="ProcessStep3.excludedcolumns[column]" /></th>
                    </thead>
                    <tbody>
                        <tr ng-repeat="row in ProcessStep3.currentdataset.rows">
                            <td ng-repeat="column in ProcessStep3.currentdataset.columns" ng-bind="row[column]"  ng-class="{ 'exclude' : ProcessStep3.excludedcolumns[column] }"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <ul class="nav nav-tabs" data-tabs="tabs">
            <li data-ng-repeat="item in ProcessStep3.tabs" ng-class="{'active' : item == ProcessStep3.activeTab }" ng-click="ProcessStep3.changeTab(item)">
                <a data-ng-bind="item" data-toggle="tab" href=""></a>
            </li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" data-ng-repeat="item in ProcessStep3.tabs" ng-class="{'active' : item == ProcessStep3.activeTab }" class="tab-pane">
                <div ng-if="item == 'Old Model Dataset'">
                    <div class="loader text-center" ng-show="ProcessStep3.showModelLoader">
                        <i class="spinner"></i>
                    </div>
                    <div ng-show="!ProcessStep3.showModelLoader">
                        <div class="row">
                            <div class="col-md-12"><p><strong>Model: {{ ProcessStep3.selectedmodel.title }}</strong></p></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6"><p>Type: {{ ProcessStep3.selectedmodel.type }}</p></div>
                            <div class="col-md-6"><p>Equation: {{ ProcessStep3.selectedmodel.equation }}</p></div>
                        </div>
                        <div class="clearfix" style="overflow: auto;width: 100%;">
                            <div class="form-group row">
                                <div class="col-md-4">
                                    <label>Key Column:</label>
                                </div>
                                <div class="col-md-5">
                                    <select name="keyfield" class="form-control" ng-model="ProcessStep3.modelkeyfield" ng-options="column as column for column in ProcessStep3.availablemodelcolumns" required>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-4">
                                    <label>Left Key Column:</label>
                                </div>
                                <div class="col-md-5">
                                    <select name="keyfield" class="form-control" ng-model="ProcessStep3.keyfield" ng-options="column as column for column in ProcessStep3.availablecolumns" required>
                                    </select>
                                </div>
                            </div>
                            <div class="pull-right">
                                <a href="" ng-click="ProcessStep3.selectModelColumnsAll()">Select All</a>
                                <a href="" ng-click="ProcessStep3.unselectModelColumnsAll()">Unselect All</a>
                            </div>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <th ng-repeat="column in ProcessStep3.currentmodeldataset.columns"><input type="checkbox" name="selectedcolumn" ng-change="ProcessStep3.modelColumnsChanged()" ng-model="ProcessStep3.selectedmodelcolumns[column]" /></th>
                                </thead>
                                <thead>
                                    <th ng-repeat="column in ProcessStep3.currentmodeldataset.columns" ng-bind="column" ng-class="{ 'exclude' : !ProcessStep3.selectedmodelcolumns[column] }"></th>
                                </thead>
                                <thead>
                                    <th ng-repeat="renamedcolumn in ProcessStep3.currentmodeldataset.renamedcolumnnames" ng-class="{ 'exclude' : !ProcessStep3.selectedmodelcolumns[renamedcolumn] }"><input type="text" ng-model="ProcessStep3.currentmodeldataset.renamedcolumns[renamedcolumn]" class="form-control" ng-disabled="!ProcessStep3.selectedmodelcolumns[renamedcolumn]" /></th>
                                </thead>
                                <tbody>
                                <tr ng-repeat="row in ProcessStep3.currentmodeldataset.rows">
                                    <td ng-repeat="column in ProcessStep3.currentmodeldataset.columns" ng-class="{ 'exclude' : !ProcessStep3.selectedmodelcolumns[column] }" ng-bind="row[column]"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <br/>
                        <div class="text-center">
                            <button class="btn btn-primary" ng-click="ProcessStep3.addOldModelTransformStep()">Add Step to Transforms</button>
                        </div>
                    </div>
                </div>
                <div ng-if="item == 'Search Data'">
                    <div ui-view="datasetsearch@" ng-show="ProcessStep3.showDatasetSearch">
                    </div>
                    <div ng-hide="ProcessStep3.showDatasetSearch">
                        <a href="" ng-click="ProcessStep3.showDatasetSearch = !ProcessStep3.showDatasetSearch">&lt; Back to Results</a>
                        <div class="loader text-center" ng-show="ProcessStep3.showDatasetLoader">
                            <i class="spinner"></i>
                        </div>
                        <div ng-show="!ProcessStep3.showDatasetLoader">
                            <div class="row">
                                <div class="col-md-12"><p><strong>Dataset: {{ ProcessStep3.selectedcomparitivedataset.title }}</strong></p></div>
                            </div>
                            <div class="clearfix" style="overflow: auto;width: 100%;">
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <label>Key Field:</label>
                                    </div>
                                    <div class="col-md-5">
                                        <select name="keyfield" class="form-control" ng-model="ProcessStep3.comparitivedatasetkeyfield" ng-options="column as column for column in ProcessStep3.availablecomparitivedatasetcolumns" required>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <label>Left Key Column:</label>
                                    </div>
                                    <div class="col-md-5">
                                        <select name="keyfield" class="form-control" ng-model="ProcessStep3.keyfield" ng-options="column as column for column in ProcessStep3.availablecolumns" required>
                                        </select>
                                    </div>
                                </div>
                                <div class="pull-right">
                                    <a href="" ng-click="ProcessStep3.selectDatasetColumnsAll()">Select All</a>
                                    <a href="" ng-click="ProcessStep3.unselectDatasetColumnsAll()">Unselect All</a>
                                </div>
                                <table class="table table-striped table-bordered">
                                    <thead>
                                    <th ng-repeat="column in ProcessStep3.currentselecteddataset.columns"><input type="checkbox" name="selectedcolumn" ng-change="ProcessStep3.datasetColumnsChanged()" ng-model="ProcessStep3.selecteddatasetcolumns[column]" /></th>
                                    </thead>
                                    <thead>
                                    <th ng-repeat="column in ProcessStep3.currentselecteddataset.columns" ng-bind="column" ng-class="{ 'exclude' : !ProcessStep3.selecteddatasetcolumns[column] }"></th>
                                    </thead>
                                    <thead>
                                    <th ng-repeat="renamedcolumn in ProcessStep3.currentselecteddataset.renamedcolumnnames" ng-class="{ 'exclude' : !ProcessStep3.selecteddatasetcolumns[renamedcolumn] }"><input type="text" ng-model="ProcessStep3.currentselecteddataset.renamedcolumns[renamedcolumn]" class="form-control" ng-disabled="!ProcessStep3.selecteddatasetcolumns[renamedcolumn]" /></th>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="row in ProcessStep3.currentselecteddataset.rows">
                                        <td ng-repeat="column in ProcessStep3.currentselecteddataset.columns" ng-class="{ 'exclude' : !ProcessStep3.selecteddatasetcolumns[column] }" ng-bind="row[column]"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br/>
                            <div class="text-center">
                                <button class="btn btn-primary" ng-click="ProcessStep3.addDatasetTransformStep()">Add Step to Transforms</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-if="item == 'Transform Steps'">
                    <div ng-show="!ProcessStep3.transformSteps.length">
                        No transformations added yet.
                    </div>
                    <ul dnd-list="ProcessStep3.transformSteps" class="list-unstyled transformsteps" style="overflow: auto;">
                        <li ng-repeat="step in ProcessStep3.transformSteps"
                            dnd-draggable="step"
                            dnd-moved="ProcessStep3.transformSteps.splice($index, 1)"
                            dnd-effect-allowed="move" style="white-space: nowrap;" class="{{ step.type }}">
                            <div ng-if="step.source == 'modeldataset'">
                                <a href="" ng-click="ProcessStep3.removeStep(step)"><span class="glyphicon glyphicon-remove"></span></a>
                                {{ step | json }}
                            </div>
                            <div ng-if="step.source == 'dataset'">
                                <a href="" ng-click="ProcessStep3.removeStep(step)"><span class="glyphicon glyphicon-remove"></span></a>
                                {{ step | json }}
                            </div>
                            <div ng-if="step.type == 'drop'">
                                <a href="" ng-click="ProcessStep3.removeStep(step)"><span class="glyphicon glyphicon-remove"></span></a>
                                Drop Column: {{ step.columnname }}
                            </div>
                        </li>
                    </ul>

                </div>
            </div>
        </div>
    </div>
</div>
<br/><br/><br/><br/>
<div>
    <button ng-click="ProcessWizard.goBack()" class="btn btn-seconday pull-left">Back - Choose Data</button>
    <button ng-click="ProcessWizard.changeState('lab.process2.step4')" class="btn btn-primary pull-right">Next - Add a model to your workflow</button>
</div>
